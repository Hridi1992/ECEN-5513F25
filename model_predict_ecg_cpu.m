function PredClassProb = model_predict_ecg_cpu(TimeSeriesSignal) %#codegen\n%% ECG Classification - CPU Version\n    % parameters\n    ModFile = 'ecg_model.mat';\n    ImgSize = [227 227];\n    \n    % Initialize output\n    PredClassProb = zeros(1, 3, 'single');\n    \n    % sanity check\n    assert(isequal(size(TimeSeriesSignal), [1 65536]), 'Signal must be 1x65536'); \n    \n    %% cwt transformation\n    % Compute CWT\n    cfs = cwt(TimeSeriesSignal, 'morse', 1, 'VoicesPerOctave', 12);\n    cfs = abs(cfs);\n    \n    %% Image generation\n    % Load colormap\n    cmapj128 = coder.load('cmapj128.mat');\n    cmap = cmapj128.cmapj128;\n    \n    % Rescale and convert\n    cfs_rescaled = rescale(cfs);\n    im_indexed = round(255 * cfs_rescaled) + 1;\n    im_indexed = uint8(im_indexed);  % Explicit cast\n    \n    % Convert to RGB using simplified function\n    rgb = ind2rgb_simple(im_indexed, cmap);\n    \n    % Resize and convert\n    im_resized = imresize(rgb, ImgSize);\n    im = im2uint8(im_resized);\n    \n    %% model prediction\n    persistent model;\n    if isempty(model)\n        model = coder.loadDeepLearningNetwork(ModFile, 'mynet');\n    end\n\n    PredClassProb = predict(model, im);\nend\n\nfunction rgb = ind2rgb_simple(im, cmap)\n%% Simplified ind2rgb for CPU\n    [rows, cols] = size(im);\n    rgb = zeros(rows, cols, 3, 'like', cmap);\n    \n    for i = 1:rows\n        for j = 1:cols\n            idx = double(im(i, j));\n            if idx < 1\n                idx = 1;\n            elseif idx > size(cmap, 1)\n                idx = size(cmap, 1);\n            end\n            rgb(i, j, 1) = cmap(idx, 1);\n            rgb(i, j, 2) = cmap(idx, 2);\n            rgb(i, j, 3) = cmap(idx, 3);\n        end\n    end\nend\n